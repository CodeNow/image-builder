machine:
  node:
    version: 0.10.28
  services:
    - docker
test:
  pre:
    - npm install http-proxy
    - node scripts/start-proxy.js:
        background: true
    - ./scripts/getIpAddress.sh > DOCKER_IP
    - npm install
    - docker build -t test-image-builder .
    - mkdir -p /tmp/cache
    - mkdir -p /tmp/layer-cache
  override:
    - npm run lint
    - npm test:
        environment:
          CACHE_DIR: /tmp/cache
          LAYER_CACHE_DIR: /tmp/layer-cache
          RUNNABLE_DOCKER: localhost:5555
    - ./scripts/run-tests.sh
